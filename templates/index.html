<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>NHL Team Stats</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <style>
        .spinner-overlay {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(255,255,255,0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            display: none;
        }
        .navbar .dropdown-menu {
            max-height: 60vh;
            overflow-y: auto;
        }
        .team-logo {
            width: 24px;
            height: 24px;
            margin-right: 6px;
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-light bg-light sticky-top">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">NHL Stats</a>
            <div class="navbar-nav">
                <div class="nav-item dropdown" id="AtlanticDropdown">
                    <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">Atlantic</a>
                    <ul class="dropdown-menu"></ul>
                </div>
                <div class="nav-item dropdown" id="MetropolitanDropdown">
                    <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">Metropolitan</a>
                    <ul class="dropdown-menu"></ul>
                </div>
                <div class="nav-item dropdown" id="CentralDropdown">
                    <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">Central</a>
                    <ul class="dropdown-menu"></ul>
                </div>
                <div class="nav-item dropdown" id="PacificDropdown">
                    <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">Pacific</a>
                    <ul class="dropdown-menu"></ul>
                </div>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <h2 id="team-name"></h2>
        <div class="table-responsive">
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>Name</th>
                        <th>Position</th>
                        <th>Goals</th>
                        <th>Assists</th>
                    </tr>
                </thead>
                <tbody id="player-stats"></tbody>
            </table>
        </div>
    </div>

    <div class="spinner-overlay" id="spinner">
        <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Loading...</span>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        async function fetchTeams() {
            const response = await fetch('/teams');
            const teams = await response.json();
            const divisions = {
                'Atlantic': [],
                'Metropolitan': [],
                'Central': [],
                'Pacific': []
            };
            teams.forEach(team => {
                if (divisions[team.division]) {
                    divisions[team.division].push(team);
                }
            });

            for (const [division, teamList] of Object.entries(divisions)) {
                const menu = document.querySelector(`#${division}Dropdown .dropdown-menu`);
                menu.innerHTML = '';
                teamList.forEach(team => {
                    const item = document.createElement('li');
                    item.innerHTML = `<a class="dropdown-item" href="#" data-team="${team.abbrev}">
                        <img src="${team.logo}" class="team-logo"> ${team.name}
                    </a>`;
                    item.querySelector('a').addEventListener('click', () => loadRoster(team.abbrev, team.name));
                    menu.appendChild(item);
                });
            }
        }

        async function loadRoster(abbrev, name) {
            document.getElementById('spinner').style.display = 'flex';
            const response = await fetch(`/roster/${abbrev}`);
            const players = await response.json();
            const tableBody = document.getElementById('player-stats');
            tableBody.innerHTML = '';
            players.forEach(player => {
                const row = `<tr>
                    <td>${player.sweaterNumber}</td>
                    <td>${player.name}</td>
                    <td>${player.position}</td>
                    <td>${player.goals}</td>
                    <td>${player.assists}</td>
                </tr>`;
                tableBody.insertAdjacentHTML('beforeend', row);
            });
            document.getElementById('team-name').textContent = name;
            document.getElementById('spinner').style.display = 'none';
        }

        fetchTeams();
    </script>
</body>
</html>
