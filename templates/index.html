<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Hockey Roster</title>

  <!-- DataTables core CSS -->
  <link
    rel="stylesheet"
    href="https://cdn.datatables.net/1.13.4/css/jquery.dataTables.min.css"
  />
  <!-- Buttons (for ColVis) -->
  <link
    rel="stylesheet"
    href="https://cdn.datatables.net/buttons/2.3.6/css/buttons.dataTables.min.css"
  />
  <!-- ColReorder -->
  <link
    rel="stylesheet"
    href="https://cdn.datatables.net/colreorder/1.6.2/css/colReorder.dataTables.min.css"
  />

  <!-- jQuery + DataTables + Extensions JS -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.datatables.net/colreorder/1.6.2/js/dataTables.colReorder.min.js"></script>
  <script src="https://cdn.datatables.net/buttons/2.3.6/js/dataTables.buttons.min.js"></script>
  <script src="https://cdn.datatables.net/buttons/2.3.6/js/buttons.colVis.min.js"></script>

  <style>
    body { font-family: sans-serif; padding: 1rem; }
    #team-select { margin-bottom: 1rem; }
  </style>
</head>
<body>
  <h1>Hockey Roster</h1>

  <label for="team-select">Select a team:</label>
  <select id="team-select"></select>

  <table id="statsTable" class="display" style="width:100%">
    <thead>
      <tr>
        <th>Name</th>
        <th>#</th>
        <th>Pos</th>
        <th>GP</th>
        <th>G</th>
        <th>A</th>
        <th>P</th>
        <th>Playoff GP</th>
        <th>Playoff G</th>
        <th>Playoff A</th>
        <th>Playoff P</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    $(document).ready(function() {
      // Initialize empty DataTable
      const table = $('#statsTable').DataTable({
        data: [],
        columns: [
          { data: 'name' },
          { data: 'number' },
          { data: 'position' },
          { data: 'gamesPlayed' },
          { data: 'goals' },
          { data: 'assists' },
          { data: 'points' },
          { data: 'playoffGames' },
          { data: 'playoffGoals' },
          { data: 'playoffAssists' },
          { data: 'playoffPoints' }
        ],
        colReorder: true,
        stateSave: true,
        dom: 'Bfrtip',
        buttons: ['colvis']
      });

      // Load teams into the <select>
      $.getJSON('/teams', function(divisions) {
        const $sel = $('#team-select');
        // flatten all divisions into one array
        const teams = Object.values(divisions).flat();
        teams.forEach(t => {
          $sel.append(new Option(t.name, t.abbrev));
        });
        // trigger load for the first team
        $sel.val(teams[0]?.abbrev).trigger('change');
      });

      // On team change, fetch its roster and reload the table
      $('#team-select').on('change', function() {
        const abbr = this.value;
        $.getJSON(`/roster/${abbr}`, function(res) {
          table.clear().rows.add(res.players).draw();
        });
      });
    });
  </script>
</body>
</html>
