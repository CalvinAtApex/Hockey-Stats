<!-- templates/index.html -->
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>NHL Dashboard</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
        rel="stylesheet">
  <style>
    #spinner {
      position: fixed;
      top: 50%; left: 50%;
      transform: translate(-50%,-50%);
      display: none;
    }
  </style>
</head>
<body>
  <nav class="navbar navbar-expand-lg navbar-light bg-light">
    <ul class="navbar-nav" id="divisions"></ul>
  </nav>

  <div class="container my-4">
    <div id="roster"></div>
    <div id="stats"></div>
  </div>

  <div id="spinner">
    <div class="spinner-border" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
  </div>

  <script>
    const spinner = document.getElementById('spinner');
    function showSpinner(){ spinner.style.display='block'; }
    function hideSpinner(){ spinner.style.display='none'; }

    async function loadTeams(){
      showSpinner();
      const res = await fetch('/teams');
      const divs = await res.json();
      const nav = document.getElementById('divisions');
      nav.innerHTML = '';
      for(const div in divs){
        const li = document.createElement('li');
        li.className = 'nav-item dropdown';
        li.innerHTML = `
          <a class="nav-link dropdown-toggle" href="#" role="button"
             data-bs-toggle="dropdown">${div}</a>
          <ul class="dropdown-menu">
            ${divs[div].map(t=>`
              <li>
                <a class="dropdown-item" href="#"
                   onclick="loadRoster('${t.abbr}')">
                  <img src="${t.logo}" width="20" class="me-1">
                  ${t.name}
                </a>
              </li>
            `).join('')}
          </ul>`;
        nav.appendChild(li);
      }
      hideSpinner();
    }

    async function loadRoster(team){
      showSpinner();
      const res = await fetch(`/roster/${team}`);
      const players = await res.json();
      document.getElementById('roster').innerHTML = `
        <h3>${team} Roster</h3>
        <div class="list-group">
          ${players.map(p=>`
            <a href="#" class="list-group-item list-group-item-action"
               onclick="loadStats(${p.id})">
              #${p.number} ${p.name} (${p.pos})
            </a>
          `).join('')}
        </div>`;
      hideSpinner();
    }

    async function loadStats(id){
      showSpinner();
      const res = await fetch(`/player/${id}`);
      const p = await res.json();
      document.getElementById('stats').innerHTML = `
        <h3>${p.name} — ${p.position}</h3>
        <div class="row mb-3">
          <div class="col-auto">
            <img src="${p.headshot}" class="img-thumbnail" width="120">
          </div>
          <div class="col">
            <table class="table table-striped">
              <thead>
                <tr>
                  <th>Type</th><th>GP</th><th>G</th><th>A</th><th>P</th><th>±</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <th>Regular ${p.regular.season}</th>
                  <td>${p.regular.games}</td>
                  <td>${p.regular.goals}</td>
                  <td>${p.regular.assists}</td>
                  <td>${p.regular.points}</td>
                  <td>${p.regular.plusMinus}</td>
                </tr>
                <tr>
                  <th>Playoffs</th>
                  <td>${p.playoffs.games}</td>
                  <td>${p.playoffs.goals}</td>
                  <td>${p.playoffs.assists}</td>
                  <td>${p.playoffs.points}</td>
                  <td>${p.playoffs.plusMinus}</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>`;
      hideSpinner();
    }

    document.addEventListener('DOMContentLoaded', loadTeams);
  </script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js">
  </script>
</body>
</html>
