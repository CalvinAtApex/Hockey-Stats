<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>NHL Roster Viewer</title>
</head>
<body>
    <h1>NHL Roster Viewer</h1>
    <label for="teamSelect">Select Team:</label>
    <select id="teamSelect">
        <option value="">-- Select a team --</option>
        {% for team in teams %}
            <option value="{{ team.abbreviation }}">{{ team.name }}</option>
        {% endfor %}
    </select>

    <h2 id="teamName"></h2>
    <table id="rosterTable" border="1" style="display: none;">
        <thead>
            <tr>
                <th>Number</th>
                <th>Name</th>
                <th>Position</th>
                <th>Goals</th>
                <th>Assists</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>

    <script>
        document.getElementById('teamSelect').addEventListener('change', function() {
            const teamAbbrev = this.value;
            if (!teamAbbrev) return;

            document.getElementById('teamName').innerText = '';
            const table = document.getElementById('rosterTable');
            const tbody = table.querySelector('tbody');
            tbody.innerHTML = '';
            table.style.display = 'none';

            fetch(`/roster/${teamAbbrev}`)
                .then(response => response.json())
                .then(data => {
                    if (data.players.length === 0) {
                        alert('No roster data found.');
                        return;
                    }

                    document.getElementById('teamName').innerText = teamAbbrev;
                    table.style.display = 'table';

                    data.players.forEach(player => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${player.number}</td>
                            <td>${player.name}</td>
                            <td>${player.position}</td>
                            <td id="goals-${player.number}">Loading...</td>
                            <td id="assists-${player.number}">Loading...</td>
                        `;
                        tbody.appendChild(row);

                        // Async fetch stats per player
                        fetch(`https://api-web.nhle.com/v1/player/${player.number}/summary`)
                            .then(resp => resp.json())
                            .then(playerData => {
                                const stats = playerData?.careerTotals?.regularSeason || {};
                                document.getElementById(`goals-${player.number}`).innerText = stats.goals ?? '0';
                                document.getElementById(`assists-${player.number}`).innerText = stats.assists ?? '0';
                            })
                            .catch(err => {
                                document.getElementById(`goals-${player.number}`).innerText = '0';
                                document.getElementById(`assists-${player.number}`).innerText = '0';
                            });
                    });
                })
                .catch(() => alert('Error loading roster.'));
        });
    </script>
</body>
</html>
