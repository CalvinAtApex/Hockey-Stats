<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>NHL Team Stats</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 0; background: #f9f9f9; }
        .navbar { background: #00205b; overflow: hidden; display: flex; align-items: center; padding: 0 10px; }
        .dropdown { position: relative; }
        .dropbtn { color: white; padding: 14px 16px; background: none; border: none; cursor: pointer; font-size: 16px; }
        .dropdown-content { display: none; position: absolute; background-color: #ffffff; min-width: 200px; z-index: 1; box-shadow: 0 8px 16px rgba(0,0,0,0.2); }
        .dropdown-content .team-link { color: black; padding: 10px; display: flex; align-items: center; cursor: pointer; }
        .dropdown-content .team-link img { width: 20px; height: 20px; margin-right: 10px; }
        .dropdown:hover .dropdown-content { display: block; }

        /* Mobile Hamburger */
        .hamburger { display: none; cursor: pointer; color: white; font-size: 24px; margin-left: auto; }
        .mobile-menu { display: none; flex-direction: column; background: #00205b; }
        .mobile-menu .dropdown { width: 100%; }
        .mobile-menu .dropbtn { width: 100%; text-align: left; }

        @media (max-width: 768px) {
            .navbar > .dropdown { display: none; }
            .hamburger { display: block; }
            .mobile-menu { display: none; }
            .mobile-menu.active { display: flex; }
        }

        table { border-collapse: collapse; width: 100%; margin-top: 20px; }
        th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
        th { background-color: #e0e0e0; }
        #roster-title { margin: 20px 0 10px 0; font-size: 20px; }

        .spinner { display: none; margin: 20px auto; border: 8px solid #f3f3f3; border-top: 8px solid #00205b; border-radius: 50%; width: 50px; height: 50px; animation: spin 1s linear infinite; }
        @keyframes spin { 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

<div class="navbar">
    <div class="dropdowns"></div>
    <div class="hamburger">&#9776;</div>
</div>
<div class="mobile-menu"></div>

<div class="content">
    <h2 id="roster-title"></h2>
    <div class="spinner"></div>
    <table id="roster-table">
        <thead>
            <tr>
                <th>#</th>
                <th>Name</th>
                <th>Position</th>
                <th>Goals</th>
                <th>Assists</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>
</div>

<script>
$(document).ready(function() {
    const divisions = { Atlantic: [], Metropolitan: [], Central: [], Pacific: [] };

    function buildDropdowns(container) {
        container.empty();
        for (const [division, teams] of Object.entries(divisions)) {
            const dropdown = $('<div>').addClass('dropdown');
            const dropbtn = $(`<button class="dropbtn">${division}</button>`);
            const dropdownContent = $('<div>').addClass('dropdown-content');

            teams.forEach(team => {
                const link = $(`<div class="team-link" data-abbrev="${team.abbrev}"><img src="${team.logo}"> ${team.name}</div>`);
                dropdownContent.append(link);
            });

            dropdown.append(dropbtn).append(dropdownContent);
            container.append(dropdown);
        }
    }

    $.get('/teams', function(teams) {
        teams.forEach(team => {
            const abbrev = team.abbrev;
            if (['BOS','BUF','DET','FLA','MTL','OTT','TBL','TOR'].includes(abbrev)) divisions['Atlantic'].push(team);
            else if (['CAR','CBJ','NJD','NYI','NYR','PHI','PIT','WSH'].includes(abbrev)) divisions['Metropolitan'].push(team);
            else if (['CHI','COL','DAL','MIN','NSH','STL','WPG','UTA'].includes(abbrev)) divisions['Central'].push(team);
            else if (['ANA','CGY','EDM','LAK','SEA','SJS','VAN','VGK'].includes(abbrev)) divisions['Pacific'].push(team);
        });

        buildDropdowns($('.dropdowns'));   // Desktop navbar
        buildDropdowns($('.mobile-menu')); // Mobile menu

        $(document).on('click', '.team-link', function() {
            const abbrev = $(this).data('abbrev');
            $('#roster-title').text(`Roster for ${abbrev}`);
            $('.spinner').show();
            $.get(`/roster/${abbrev}`, function(players) {
                $('.spinner').hide();
                const tbody = $('#roster-table tbody').empty();
                players.forEach(player => {
                    tbody.append(`
                        <tr>
                            <td>${player.sweaterNumber}</td>
                            <td>${player.name}</td>
                            <td>${player.position}</td>
                            <td>${player.goals}</td>
                            <td>${player.assists}</td>
                        </tr>
                    `);
                });
            });
        });
    });

    $('.hamburger').click(function() {
        $('.mobile-menu').toggleClass('active');
    });
});
</script>

</body>
</html>
